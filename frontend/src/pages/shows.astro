---
import Layout from '../layouts/Layout.astro';
import { ShowsPageContent } from '../components/ShowsPageContent';
import { fetchShows, fetchStations } from '../api/client';
import type { Show, Station } from '../types';

// Fetch data
let shows: Show[] = [];
let stations: Station[] = [];

try {
  const [showsData, stationsData] = await Promise.all([
    fetchShows().catch(() => []),
    fetchStations().catch(() => [])
  ]);

  shows = Array.isArray(showsData) 
    ? showsData 
    : showsData.results || [];

  stations = Array.isArray(stationsData)
    ? stationsData
    : stationsData.results || [];
} catch (error) {
  console.error('Error fetching shows/stations:', error);
  // Use empty data as fallback
}
---

<Layout
  title="Radio Shows â€” Radio Reads"
  description="Browse the radio shows covered by Radio Reads. BBC Radio 4 programmes and NPR shows including Front Row, Free Thinking, Bookclub, A Good Read and Fresh Air."
  pathname={Astro.url.pathname}
>
  <ShowsPageContent shows={shows} stations={stations} client:load />
</Layout>

